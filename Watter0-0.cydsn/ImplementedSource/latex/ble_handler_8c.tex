\doxysection{ble\+Handler.\+c File Reference}
\label{ble_handler_8c}\index{bleHandler.c@{bleHandler.c}}


module for all things bluetooth  


{\ttfamily \#include \char`\"{}project.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}stdio.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Free\+R\+T\+O\+S.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}task.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}semphr.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}limits.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ble\+Handler.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}sampler.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}wat\+Utility.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Battery.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\label{ble_handler_8c_a2a3d524a533130b5695d7a8be98311c4}} 
\#define {\bfseries C\+P\+S\+\_\+\+C\+P\+\_\+\+R\+E\+S\+P\+\_\+\+L\+E\+N\+G\+TH}~(0u)
\item 
\mbox{\label{ble_handler_8c_ac2846bc72dbc808c5e4b8a4238631fb4}} 
\#define {\bfseries C\+P\+S\+\_\+\+C\+P\+\_\+\+R\+E\+S\+P\+\_\+\+O\+P\+\_\+\+C\+O\+D\+ES}~(1u)
\item 
\mbox{\label{ble_handler_8c_a55e1bf5c96381538a2ba817ddf79b684}} 
\#define {\bfseries C\+P\+S\+\_\+\+C\+P\+\_\+\+R\+E\+S\+P\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+O\+P\+\_\+\+C\+O\+DE}~(2u)
\item 
\mbox{\label{ble_handler_8c_ada0e8213ae438268baffa305ca18d00c}} 
\#define {\bfseries C\+P\+S\+\_\+\+C\+P\+\_\+\+R\+E\+S\+P\+\_\+\+V\+A\+L\+UE}~(3u)
\item 
\mbox{\label{ble_handler_8c_af562c0df12be7f455cfc3435f55ce577}} 
\#define {\bfseries C\+P\+S\+\_\+\+C\+P\+\_\+\+R\+E\+S\+P\+\_\+\+P\+A\+R\+A\+M\+E\+T\+ER}~(4u)
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\label{ble_handler_8c_a52644c11a8743091de7c71835b8bb00f}} 
void {\bfseries handle\+C\+Y\+\_\+\+B\+L\+E\+\_\+\+S\+E\+T\+T\+\_\+\+T\+R\+A\+N\+S\+F\+E\+R\+D\+E\+L\+A\+Y\+\_\+\+C\+H\+A\+R\+\_\+\+H\+A\+N\+D\+LE} (cy\+\_\+stc\+\_\+ble\+\_\+gatts\+\_\+write\+\_\+cmd\+\_\+req\+\_\+param\+\_\+t $\ast$parameter)
\item 
\mbox{\label{ble_handler_8c_a40818dbd835b01470b4606590bdca9ff}} 
void {\bfseries handle\+C\+Y\+\_\+\+B\+L\+E\+\_\+\+S\+E\+T\+T\+\_\+\+S\+A\+M\+P\+L\+E\+D\+E\+L\+A\+Y\+\_\+\+C\+H\+A\+R\+\_\+\+H\+A\+N\+D\+LE} (cy\+\_\+stc\+\_\+ble\+\_\+gatts\+\_\+write\+\_\+cmd\+\_\+req\+\_\+param\+\_\+t $\ast$parameter)
\item 
\mbox{\label{ble_handler_8c_ab175a85c9fa9baee29d61379f55791b5}} 
void {\bfseries handle\+G\+A\+T\+T\+S\+\_\+\+W\+R\+I\+T\+E\+\_\+\+R\+EQ} (void $\ast$parameter)
\item 
\mbox{\label{ble_handler_8c_a1f05e1196ec2a9dfb338a29ea9a3b257}} 
void \textbf{ generic\+Event\+Handler} (uint32 event, void $\ast$event\+Parameter)
\begin{DoxyCompactList}\small\item\em Main B\+LE event handler, this gets called when an B\+LE event occurs. \end{DoxyCompactList}\item 
\mbox{\label{ble_handler_8c_ade3fbd28558351b572631b361b17e39f}} 
void {\bfseries ble\+Interrupt\+Notify} ()
\item 
void \textbf{ task\+\_\+ble} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em The task called when a B\+LE event occurs This task calls the Cy\+\_\+\+B\+L\+E\+\_\+\+Process\+Events() which will call the callback function. \end{DoxyCompactList}\item 
void \textbf{ task\+\_\+\+Send\+Effekt} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em The Free\+R\+T\+OS task to send C\+PS notifications. \end{DoxyCompactList}\item 
void \textbf{ task\+\_\+update\+Battery} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em task to update the G\+A\+TT database periodicly with new battery level. \end{DoxyCompactList}\item 
\mbox{\label{ble_handler_8c_a58daa0ca3c0484e4090c4dba2d6437ec}} 
void \textbf{ Send\+Effekt\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em Init function for the send\+Effect\+Info variable. \end{DoxyCompactList}\item 
void \textbf{ update\+Settings\+Gatt} (\textbf{ settings\+\_\+t} setting, uint16 value, uint8 flags)
\begin{DoxyCompactList}\small\item\em Helper function for updating the G\+A\+TT database and settings\+\_\+t struct with new settings. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\label{ble_handler_8c_ac0d707b8d9db5de617ea51163e1828fb}} 
Semaphore\+Handle\+\_\+t \textbf{ power\+Mutex}
\begin{DoxyCompactList}\small\item\em The mutex locked when using {\ttfamily send\+Effect\+Info}. \end{DoxyCompactList}\item 
\mbox{\label{ble_handler_8c_a68372cda775aa80082cbdfbdcab7776a}} 
\textbf{ C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S\+T\+A\+TE} \textbf{ conn\+State} = N\+O\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED
\begin{DoxyCompactList}\small\item\em Enum for different states of connection to a client. \end{DoxyCompactList}\item 
\mbox{\label{ble_handler_8c_aa941c5603342b70cb90671e0210300f4}} 
\textbf{ Send\+Effekt\+\_\+t} \textbf{ send\+Effect\+Info}
\begin{DoxyCompactList}\small\item\em The struct used for any information to be send with a C\+PS notification. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
module for all things bluetooth 

\begin{DoxyAuthor}{Author}
nicklas 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2020-\/12-\/13 
\end{DoxyDate}


\doxysubsection{Function Documentation}
\mbox{\label{ble_handler_8c_a77f342f27014948fc7999194c853ce8e}} 
\index{bleHandler.c@{bleHandler.c}!task\_ble@{task\_ble}}
\index{task\_ble@{task\_ble}!bleHandler.c@{bleHandler.c}}
\doxysubsubsection{task\_ble()}
{\footnotesize\ttfamily void task\+\_\+ble (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})}



The task called when a B\+LE event occurs This task calls the Cy\+\_\+\+B\+L\+E\+\_\+\+Process\+Events() which will call the callback function. 


\begin{DoxyParams}{Parameters}
{\em arg} & unused \\
\hline
\end{DoxyParams}
\mbox{\label{ble_handler_8c_a7a6889de3e114c4ad039b377f4b3070d}} 
\index{bleHandler.c@{bleHandler.c}!task\_SendEffekt@{task\_SendEffekt}}
\index{task\_SendEffekt@{task\_SendEffekt}!bleHandler.c@{bleHandler.c}}
\doxysubsubsection{task\_SendEffekt()}
{\footnotesize\ttfamily void task\+\_\+\+Send\+Effekt (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})}



The Free\+R\+T\+OS task to send C\+PS notifications. 


\begin{DoxyParams}{Parameters}
{\em arg} & unused \\
\hline
\end{DoxyParams}
\mbox{\label{ble_handler_8c_a88bc9880ec3f46995024e0926ba24cd9}} 
\index{bleHandler.c@{bleHandler.c}!task\_updateBattery@{task\_updateBattery}}
\index{task\_updateBattery@{task\_updateBattery}!bleHandler.c@{bleHandler.c}}
\doxysubsubsection{task\_updateBattery()}
{\footnotesize\ttfamily void task\+\_\+update\+Battery (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})}



task to update the G\+A\+TT database periodicly with new battery level. 

This task periodically updates the battery level in the G\+A\+TT database. The G\+A\+TT database is only updated at a certain frequency way below the sampling rate to avoid overloading the system by updating the database at a high frequency. \mbox{\label{ble_handler_8c_a6d98794838cd173d86a8931f9deb1660}} 
\index{bleHandler.c@{bleHandler.c}!updateSettingsGatt@{updateSettingsGatt}}
\index{updateSettingsGatt@{updateSettingsGatt}!bleHandler.c@{bleHandler.c}}
\doxysubsubsection{updateSettingsGatt()}
{\footnotesize\ttfamily void update\+Settings\+Gatt (\begin{DoxyParamCaption}\item[{\textbf{ settings\+\_\+t}}]{setting,  }\item[{uint16}]{value,  }\item[{uint8}]{flags }\end{DoxyParamCaption})}



Helper function for updating the G\+A\+TT database and settings\+\_\+t struct with new settings. 


\begin{DoxyParams}{Parameters}
{\em setting} & \\
\hline
{\em value} & \\
\hline
{\em flags} & \\
\hline
\end{DoxyParams}
